
<!DOCTYPE html><html lang="id"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Dashboard - <%= child.name %></title>
<link href="/public/css/output.css" rel="stylesheet" />
</head><body class="bg-gray-50">
<div class="max-w-6xl mx-auto px-4 py-8 space-y-6">

  <div class="flex items-start justify-between">
    <div>
      <h1 class="text-2xl font-semibold"><%= child.name %></h1>
      <div class="text-sm text-gray-600">NIS: <%= child.nis %></div>
    </div>
    <a class="text-sm text-gray-600 underline" href="/wali">Ganti Anak</a>
  </div>

  <!-- Ringkasan -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-white rounded shadow p-4">
      <div class="text-gray-600 text-sm">Jumlah Tagihan Belum Lunas</div>
      <div class="text-2xl font-semibold"><%= summary.cnt %> tagihan</div>
    </div>
    <div class="bg-white rounded shadow p-4">
      <div class="text-gray-600 text-sm">Total Tunggakan</div>
      <div class="text-2xl font-semibold"><%= rp(summary.total_sisa || 0) %></div>
    </div>
  </div>

  <!-- Outstanding -->
  <div class="bg-white rounded shadow p-4">
    <h2 class="font-semibold mb-3">Tagihan Outstanding</h2>
    <% if ((outstanding||[]).length === 0) { %>
      <div class="text-sm text-gray-500">Tidak ada tagihan outstanding.</div>
    <% } else { %>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2">Periode</th>
              <th class="text-left p-2">Nama</th>
              <th class="text-right p-2">Nominal</th>
              <th class="text-right p-2">Terbayar</th>
              <th class="text-right p-2">Sisa</th>
            </tr>
          </thead>
          <tbody>
            <% outstanding.forEach(b => { %>
              <tr class="border-t">
                <td class="p-2"><%= b.period_year %>-<%= String(b.period_month).padStart(2,'0') %></td>
                <td class="p-2"><%= b.name %></td>
                <td class="p-2 text-right"><%= rp(b.amount_due) %></td>
                <td class="p-2 text-right"><%= rp(b.amount_paid) %></td>
                <td class="p-2 text-right"><%= rp(b.amount_due - b.amount_paid) %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <!-- Riwayat Pembayaran -->
  <div class="bg-white rounded shadow p-4">
    <h2 class="font-semibold mb-3">Riwayat Pembayaran</h2>
    <% if ((payments||[]).length === 0) { %>
      <div class="text-sm text-gray-500">Belum ada pembayaran.</div>
    <% } else { %>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-gray-100">
            <tr>
              <th class="text-left p-2">Tanggal</th>
              <th class="text-left p-2">Metode</th>
              <th class="text-left p-2">No. Bukti</th>
              <th class="text-right p-2">Total</th>
              <th class="text-left p-2">Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% payments.forEach(p => { %>
              <tr class="border-t">
                <td class="p-2"><%= new Date(p.payment_date).toLocaleString('id-ID') %></td>
                <td class="p-2"><%= p.method %></td>
                <td class="p-2"><%= p.receipt_no %></td>
                <td class="p-2 text-right"><%= rp(p.total_amount) %></td>
                <td class="p-2">
                  <a class="text-blue-700" href="/wali/pembayaran/<%= p.id %>/print" target="_blank">Cetak</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

</div>
</body></html>
