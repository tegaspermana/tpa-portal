<!DOCTYPE html><html lang="id"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Template Tagihan per Santri</title>
<link href="/public/css/output.css" rel="stylesheet"/>
</head><body class="bg-gray-50">
<div class="max-w-6xl mx-auto px-4 py-6 space-y-6">
  <h1 class="text-2xl font-semibold">Template Tagihan per Santri</h1>

  <form method="get" class="flex gap-2">
    <input name="q" value="<%= q %>" class="border px-3 py-2 rounded" placeholder="Cari NIS/Nama santri"/>
    <button class="px-3 py-2 bg-gray-800 text-white rounded">Cari</button>
  </form>

  <div class="grid md:grid-cols-2 gap-4">
    <div class="bg-white rounded shadow p-4">
      <h2 class="font-semibold mb-2">Pilih Santri</h2>
      <ul class="space-y-1 max-h-72 overflow-auto">
        <% if (santriList.length === 0) { %><li class="text-sm text-gray-500">Masukkan kata kunci & klik Cari.</li><% } %>
        <% santriList.forEach(s => { %>
          <li>
            <a class="text-blue-700 hover:underline" href="/admin/billing/templates?santri_id=<%= s.id %>&q=<%= q %>">
              <%= s.name %> (<%= s.nis %>)
            </a>
          </li>
        <% }) %>
      </ul>
    </div>

    <div class="bg-white rounded shadow p-4">
      <h2 class="font-semibold mb-2">Template Aktif</h2>
      <% if (!santri_id) { %>
        <div class="text-sm text-gray-500">Pilih santri terlebih dahulu.</div>
      <% } else { %>
        <table class="min-w-full text-sm">
          <thead><tr class="bg-gray-100">
            <th class="text-left p-2">Nama</th>
            <th class="text-left p-2">Periode</th>
            <th class="text-left p-2">Nominal</th>
            <th class="text-left p-2">Aktif</th>
            <th class="text-left p-2">Aksi</th>
          </tr></thead>
          <tbody>
            <% templates.forEach(t => { %>
              <tr class="border-t">
                <td class="p-2"><%= t.name %></td>
                <td class="p-2"><%= t.start_month %> s/d <%= t.end_month || '-' %></td>
                <td class="p-2"><%= rp(t.amount) %></td>
                <td class="p-2"><%= t.active ? 'Ya' : 'Tidak' %></td>
                <td class="p-2 space-x-2">
                  <!-- Edit inline -->
                  <details>
                    <summary class="text-blue-700 cursor-pointer">Ubah</summary>
                    /admin/billing/templates/<%= t.id %>/update
                      <input name="santri_id" type="hidden" value="<%= santri_id %>" />
                      <input name="name" class="border px-2 py-1 rounded" value="<%= t.name %>" />
                      <input name="amount" class="border px-2 py-1 rounded w-32" type="number" value="<%= t.amount %>" />
                      <select name="recurrence" class="border px-2 py-1 rounded">
                        <option value="monthly" selected>Bulanan</option>
                      </select>
                      <input name="start_month" class="border px-2 py-1 rounded w-32" placeholder="YYYY-MM" value="<%= t.start_month %>" />
                      <input name="end_month" class="border px-2 py-1 rounded w-32" placeholder="YYYY-MM (opsional)" value="<%= t.end_month || '' %>" />
                      <label class="ml-2"><input type="checkbox" name="active" value="1" <%= t.active ? 'checked' : '' %> /> Aktif</label>
                      <button class="ml-2 bg-blue-600 text-white px-2 py-1 rounded">Simpan</button>
                    </form>
                  </details>
                  /admin/billing/templates/<%= t.id %>/delete
                    <input type="hidden" name="santri_id" value="<%= santri_id %>"/>
                    <button class="text-red-600" onclick="return confirm('Hapus template ini?')">Hapus</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>

        <div class="mt-4">
          <h3 class="font-semibold mb-2">Tambah Template</h3>
          /admin/billing/templates/<%= santri_id %>
            <input name="name" class="border px-2 py-1 rounded" placeholder="Nama tagihan, ex: SPP Bulanan" required />
            <input name="amount" class="border px-2 py-1 rounded w-32" type="number" placeholder="Nominal" required />
            <select name="recurrence" class="border px-2 py-1 rounded">
              <option value="monthly">Bulanan</option>
            </select>
            <input name="start_month" class="border px-2 py-1 rounded w-32" placeholder="YYYY-MM" required />
            <input name="end_month" class="border px-2 py-1 rounded w-32" placeholder="YYYY-MM (opsional)" />
            <label class="ml-2"><input type="checkbox" name="active" value="1" checked/> Aktif</label>
            <button class="ml-2 bg-green-600 text-white px-2 py-1 rounded">Tambah</button>
          </form>
        </div>
      <% } %>
    </div>
  </div>
</div>
</body></html>
